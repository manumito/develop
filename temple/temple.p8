pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
#include lang.lua
function _init()
 --enums
 dir = enum ({
 													"left", 
 													"right", 
 													"up", 
 													"down", 
 													"none"})
 
 -- constants
 boton_salto = 5
 jump_step_x = 0.5
 jump_step_y = 0.5
 jump_height = 6
	jump_start = {
								dir = dir.none,     -- horizontal
								vertical = dir.up,  -- vertical
					   height = 0, 
					   step_x = jump_step_x, 
					   step_y = jump_step_y, 
					   max_height = jump_height
					  }

 -- variables
 fase = 1
 is_jumping = false
 
 -- tablas
 fases = {}

	player = {x=1, y=110}
	
	jump = {
									dir = dir.none, -- horizontal
									vertical = dir.none,  -- vertical
						   height = 0, 
						   step_x = jump_step_x, 
						   step_y = jump_step_y, 
						   max_height = jump_height
						  }

						  
	cam = {x=0, y=0}
	
	add(fases, {x=0, y=0})   -- phase 1
	add(fases, {x=10, y=10}) -- phase 2
end 

function _update()
 update_player()
end

function _draw()
	cls()
	map(0,0,0,0)
	--camera(cam.x, cam.y)
	spr(1, player.x, player.y, 2, 2)
	print (player.x..' '..player.y,1,1,9)
end

-->8
function update_player()
 if (is_jumping) then
 	update_player_jumping()
 else
 	update_player_no_jumping()
 end
end

function update_height()
		local stepy
		-- jump is going up
		if (jump.vertical == dir.up) then
			
			-- first step in jump is powerful
			if (jump.height == 0) then 
				stepy=jump.step_y
			else
				stepy=jump.step_y	
			end
			
			if (jump.height+stepy <= jump.max_height) then
				jump.height=jump.height+stepy
				player.y=player.y-stepy
			else
				jump.vertical = dir.down
				jump.height = jump.max_height
			end
	
		else -- jump is going down
		
			if (jump.height-jump.step_y >= 0) then
				jump.height=jump.height-jump.step_y
				player.y=player.y+jump.step_y
			else
				jump.vertical = dir.none
				is_jumping=false
			end
		end
		
end

function update_player_jumping()
	update_height()
	if (jump.dir == dir.left) then

	elseif (jump.dir == dir.right) then
		
	else -- none, goes up then down
	
	end
end

function starts_jump(left, right)
	is_jumping = true
	jump.dir = jump_start.dir
	jump.vertical = jump_start.vertical
	jump.height = jump_start.height
	jump.step_x = jump_start.step_x
	jump.step_y = jump_start.step_y
	jump.max_height = jump_start.max_height
	if (left) then 
		player.x=player.x-jump.step_x
		jump.dir=dir.left
	elseif (right) then 
		player.x=player.x+jump.step_x 
		jump.dir=dir.right
	end
end

function update_player_no_jumping()
 if (btnp(boton_salto)) then 
 	starts_jump(btn(0), btn(1))
 elseif (btn(1)) then 
		player.x=player.x+1
	elseif (btn(0)) then 
		player.x=player.x-1
	end
end
__gfx__
00000000000000eeee000000090000eeee0000000008800055555555dddddddddddddddd00000000dddddddd00000000000000dd000000000000000000000000
000000000000eeeeeeee00000000eeeeeeee0000009dd90011111111dddddddddddddddd00000000dddddddd00000000000000dd000000000000000000000000
007007000009eeeeeeee90009009eeeeeeee900009d88d9011111111dddd00000000dddd000000000000000000000000000000dd000000000000000000000000
00077000009eecceeccee900009eeecceecce9008d8888d811111111ddd0000000000ddd000000000000000000000000000000dd000000000000000000000000
0007700009eeecceecceee9009eeeecceeccee908d8888d800000000dd000000000000dd000000000000000000000000000000dd000000000000000000000000
0070070009eeeeeeeeeeee9009eeeeeeeeeeee9009d88d9000000000dd000000000000dd000000000000000000000000000000dd000000000000000000000000
0000000009eeee8ee8eeee9009eeeee8ee8eee90009dd90000000000dd000000000000dd000000000000000000000000000000dd000000000000000000000000
00000000009eeee88eeee900009eeeee88eee9000008800000000000dd000000000000dd000000000000000000000000000000dd000000000000000000000000
0000000000099eeeeee9900000099eeeeee990000000000000000000dd000000000000dd000000000000000000000000dd000000000000000000000000000000
00000000000033999933000000000399993300000000000000000000dd000000000000dd000000000000000000000000dd000000000000000000000000000000
00000000000003333330000009900033333000000000000000000000dd000000000000dd000000000000000000000000dd000000000000000000000000000000
00000000000000333300000000000033330000000000000000000000dd000000000000dd000000000000000000000000dd000000000000000000000000000000
00000000000000555500000099000033330000000000000055555555ddd0000000000ddd000000000000000000000000dd000000000000000000000000000000
00000000000003300330000000000030033000000000000011111111dddd00000000dddd000000000000000000000000dd000000000000000000000000000000
00000000000003300330000009900330033000000000000011111111dddddddddddddddd00000000dddddddd00000000dd000000000000000000000000000000
00000000000033000033000000003300003300000000000011111111dddddddddddddddd00000000dddddddd00000000dd000000000000000000000000000000
__gff__
0000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
070a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a08000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1c0000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1c0000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1c0000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1c0000000000000000000000000000000500000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1c0000000000000000000000050000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1c0000000000000000000000000000000000000000000000000000000000050c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1c16161616000000000000000000000005000000000000000006060600060608000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1c0000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1c0000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1c0505050516161616160000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1c0000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1c0000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
171a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a18000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
